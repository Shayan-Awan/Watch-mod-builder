import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { 
    Settings, 
      Palette, 
        Clock, 
          Circle,
            Download,
              Share2,
                RotateCcw,
                  Eye,
                    EyeOff,
                      Play,
                        <Pause>} from 'lucide-react';
                        import { useWatchStore } from '@/lib/stores/useWatchStore';
                        import { watchComponents, calculateTotalPrice, ComponentType } from '@/data/watchComponents';
                        import WatchViewer from './WatchViewer';
                        import ComponentSelector from './ComponentSelector';
                        import ExportModal from './ExportModal';
                        import ShareModal from './ShareModal';
                        
                        export default function WatchConfigurator() {
                            const { 
                                  config, 
                                      selectedTab, 
                                          setSelectedTab, 
                                              resetConfig, 
                                                  rotating, 
                                                      setRotating,
                                                          savedConfigs,
                                                              saveConfig 
                            } = useWatchStore();
                              
                              const [exportModalOpen, setExportModalOpen] = useState(false);
                                const [shareModalOpen, setShareModalOpen] = useState(false);
                                  const [showDetails, setShowDetails] = useState(true);
                                  
                                    const totalPrice = calculateTotalPrice(config);
                                    
                                      const getSelectedComponent = (type: ComponentType) => {
                                            return watchComponents[type].find(c => c.id === config[type]);
                                      };
                                      
                                        const tabIcons = {
                                              case: Settings,
                                                  dial: Palette,
                                                      hands: Clock,
                                                          bezel: <Circle>  };

                                                              const handleSaveConfiguration = () => {
                                                                    const name = `Watch ${savedConfigs.length + 1}`;
                                                                        saveConfig(name);
                                                              };

                                                                return (
                                                                      <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
                                                                              <div className="container mx-auto px-4 py-8">
                                                                                        <div className="text-center mb-8">
                                                                                                    <h1 className="text-4xl font-bold text-gray-900 mb-2">
                                                                                                                  Professional Watch <Designer>          </h1>          <p className="text-gray-600 max-w-2xl mx-auto">
                                                                                                                                Create your perfect timepiece with our advanced 3D configurator. 
                                                                                                                                            Choose from premium cases, dials, hands, and bezels to craft a watch that's uniquely yours.
                                                                                                                                                      </p>        </div>
                                                                                                                                                              <div className="grid lg:grid-cols-3 gap-8">
                                                                                                                                                                          {/* 3D Viewer */}
                                                                                                                                                                                    <div className="lg:col-span-2">
                                                                                                                                                                                                  <Card className="shadow-lg border-0 bg-white/80 backdrop-blur-sm">
                                                                                                                                                                                                                <CardHeader className="pb-4">
                                                                                                                                                                                                                                  <div className="flex items-center justify-between">
                                                                                                                                                                                                                                                      <CardTitle className="flex items-center gap-2">
                                                                                                                                                                                                                                                                            <Eye className="h-5 w-5 text-blue-600" />
                                                                                                                                                                                                                                                                                                3D <Preview>                  </CardTitle>                  <div className="flex items-center gap-2">
                                                                                                                                                                                                                                                                                                                      <Button                      variant="outline"
                                                                                                                                                                                                                                                                                                                                            size="sm"
                                                                                                                                                                                                                                                                                                                                                                  onClick={() => SingleStoreTimestampString(!rotating)}
                                                                                                                                                                                                                                                                                                                                                                                        className="gap-2"
                                                                                                                                                                                                                                                                                                                                                                                                            >
                                                                                                                                                                                                                                                                                                                                                                                                                                    {rotating ? <Pause className="h-4 w-4" /> : <Play className="h-4 w-4" />}
                                                                                                                                                                                                                                                                                                                                                                                                                                                          {rotating ? 'Pause' : 'Rotate'}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </Button>                    <Button                      variant="outline"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    size="sm"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          onClick={() => setShowDetails(!showDetails)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                className="gap-2"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {showDetails ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  {showDetails ? 'Hide' : 'Show'} <Details>                    </Button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>                </div>              </CardHeader>              <CardContent className="p-0">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div className="relative">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <WatchViewer />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              {/* Configuration Overview Overlay */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {showDetails && (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <div className="absolute top-4 left-4 bg-black/70 backdrop-blur-sm text-white p-4 rounded-lg space-y-2 max-w-xs">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <h3 className="font-semibold text-sm">Current Configuration</h3>                      <div className="space-y-1 text-xs">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="flex justify-between">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span>Case:</span>                          <span className="font-medium">{getSelectedComponent('case')?.name}</span>                        </div>                        <div className="flex justify-between">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span>Dial:</span>                          <span className="font-medium">{getSelectedComponent('dial')?.name}</span>                        </div>                        <div className="flex justify-between">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span>Hands:</span>                          <span className="font-medium">{getSelectedComponent('hands')?.name}</span>                        </div>                        <div className="flex justify-between">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span>Bezel:</span>                          <span className="font-medium">{getSelectedComponent('bezel')?.name}</span>                        </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <Separator className="mydiv className="flex justify-between font-semibold text-yellow-400">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <span>Total:</span>                          <span>${calculateTotalPrice.toFixed(2)}</span>                        </div>                      </div>                    </div>                  )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </CardContent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </Card>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {/* Configuration Panel */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div className="space-y-6">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Component Selection */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <Card className="shadow-lg border-0 bg-white/80 backdrop-blur-sm">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <CardHeader>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <CardTitle className="flex items-center gap-2">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               .                 <Settings className="h-5 w-5 text-blue-600" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 Components
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </CardTitle>              </CardHeader>              <CardContent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <Tabs value={selectedTab} onValueChange={(value) => setSelectedTab(value as ComponentType)}>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <TabsList className="grid w-full grid-cols-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {Object.entries(tabIcons).map(([type, Icon]) => (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <TabsTrigger 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            key={type} 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    value={type}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            className="flex flex-col gap-1 p-3"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <Icon className="h-4 w-4" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <span className="text-xs capitalize">{type}</span>                      </TabsTrigger>                    ))}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         .           </TabsList>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                .  .  .       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  {Object.keys(tabIcons).map((type) => (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <TabsContent key={type} value={type} className="mt-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <ComponentSelector type={type as ComponentType} />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 .                   </TabsContent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ))}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   </Tabs>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </CardContent>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             </Card>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         {/* Price Summary */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     <Card className="shadow-lg border-0 bg-gradient-to-r from-blue-50 to-indigo-50">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <CardHeader>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <CardTitle className="text-lg">Price Breakdown</CardTitle> .             </CardHeader>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         . .        <CardContent className="space-y-3">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            .              {Object.entries(config).map(([type, selectedId]) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const component = getSelectedComponent(type as ComponentType);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  return component ? (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div key={type} className="flex justify-between items-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   . .    <span className="font-medium">{component.name}</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           <badge variant="seco-2 bg-white/20" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <</span></div></span></div></div></h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div></CardContent></Details></Button></div></Preview></CardTitle></div></CardHeader></Card></div></div></div></p></Designer>
                                                                                                    </h1>
                                                                                        </div>
                                                                              </div>
                                                                      </div>
                                                                )
                                                              }
                                                          </Circle></Pause>
}